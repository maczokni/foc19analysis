---
title: "Exploratory of Wave 3 worry"
author: "Reka Solymosi"
date: "10/06/2020"
output: word_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(haven)
library(ggplot2)
library(tidyr)
library(stringr)
library(forcats)
library(nnet)
library(stargazer)
library(broom)
library(MASS)
library(dplyr)
library(networkD3)
library(RColorBrewer)

# read in data
data <- read_dta("https://www.dropbox.com/s/l0k2if9axtpu8mu/Covid-19_Police_Study_Longitudinal_W1-W3.dta?dl=1")
#filter out people who didn't answer foc-19 Q and choose weight to use throughout
data <- data %>% filter(!is.na(b_foc)) %>% mutate(weight = ifelse(is.na(w1w2weight), 1, w1w2weight))

```


```{r newfoc19}
data <- data %>% 
  mutate(foc19_w2 = case_when(
          # Unworried
          b_foc==2 ~ "Unworried", # not worried
          # Functional
          b_foc==1 & # worried about catching covid in past 3 weeks
          b_focqol < 7   ~ "Coping",  #  quality of life is not reduced by worry
         #Dysfunctional
          b_foc== 1 & # worried about covid
            b_focqol > 6  ~ "Struggling", #quality of life affected by worry
          TRUE ~ NA_character_),    #everyone else 
         #wave3
         foc19_w3 = case_when(
          # Unworried
          c_foc==2 ~ "Unworried", # not worried
          # Functional
          c_foc==1 & # worried about catching covid in past 3 weeks
          c_focqol < 7   ~ "Coping",  #  quality of life is not reduced by worry
         #Dysfunctional
          c_foc== 1 & # worried about covid
            c_focqol > 6  ~ "Struggling", #quality of life affected by worry
          TRUE ~ NA_character_),    #everyone else 
    ) 

data$foc19_w2 <- factor(data$foc19_w2, levels = c("Unworried", "Coping","Struggling" ))
data$foc19_w3 <- factor(data$foc19_w3, levels = c("Unworried", "Coping","Struggling" ))


```


# Descriptives

Overall the wave 3 descriptives show less worry, less frequently... 

## Prevalence of worry

```{r focfreqtb, echo=FALSE}

foc_tab <- data %>% filter(!is.na(c_foc)) %>% group_by(c_foc) %>% summarise(n = sum(weight, na.rm = T)) %>% mutate(perc = round(n / sum(.$n)*100,0))

```

When asked the question “In the past 3 weeks, have you ever felt worried about getting COVID-19?”, `r foc_tab %>% filter(c_foc == 2) %>% pull(perc)`% of people said that “No”, they had not felt worried about getting COVID-19 in the past 3 weeks. 


```{r freq_tab}
freq_tab <- data %>% 
  filter(!is.na(c_focfr)) %>% 
  group_by(c_focfr) %>% 
  count() %>% 
  mutate(perc = round(n / sum(.$n)*100,0)) 

```


From those who said “Yes”, the specific instance of worry varied in frequency and intensity.  `r freq_tab %>% filter(c_focfr == 1) %>%  pull(perc)`% of people who were worried only experienced this “Once or twice” in the last 3 weeks, while `r freq_tab %>% filter(c_focfr == 8) %>%  pull(perc)`% worried more than 10 times in this timeframe: 


```{r frequchart}

ggplot(freq_tab, aes(x = as_factor(c_focfr), y = perc/100)) + 
  geom_bar(stat = "identity") + 
  geom_text(aes(label=paste0("n = ", n)),vjust=3, col = "white") +
  scale_y_continuous(labels = scales::percent, limits = c(0, 0.4)) +
  xlab("Frequency of worry") + 
  ylab("Percent of respondents") + 
  labs(title = "How frequently have you felt worried about getting \nCOVID-19in the last three weeks?") +
  theme_minimal() + 
  theme(axis.title = element_text(size = 12),
        axis.text = element_text(size = 10))
```


## Functional fear


- The ‘unworried’ group (`r data %>% group_by(foc19_w3) %>% summarise(n = sum(weight, na.rm = T)) %>% mutate(perc = round(n / sum(.$n)*100,0)) %>% filter(foc19_w3 == "Unworried") %>% pull(perc)`%): those who had not worried once about catching Covid-19 over the previous three weeks; 
precautions against the virus;
- The ‘coping’ group (`r data %>% group_by(foc19_w3) %>% summarise(n = sum(weight, na.rm = T)) %>% mutate(perc = round(n / sum(.$n)*100,0)) %>% filter(foc19_w3 == "Coping") %>% pull(perc)`%): those who had worried, but report that their quality of life was not affected by this worry; and,
- The ‘struggling’ group (`r data %>% group_by(foc19_w3) %>% summarise(n = sum(weight, na.rm = T)) %>% mutate(perc = round(n / sum(.$n)*100,0)) %>% filter(foc19_w3 == "Struggling") %>% pull(perc)`%): those who had worried, and reported that their quality of life was affected by this worry.


## Precautions

Coping and struggling take similar amount of precautions, unworried slightly less. 

```{r takeprecs}

data %>% 
    filter(!is.na(foc19_w3)) %>% 
  group_by(foc19_w3, c_prec) %>% 
  summarise(n = round(sum(weight, na.rm = T), 0)) %>% 
  mutate(perc = round(n / sum(n)*100,0)) %>% 
  rename(`Worry group` = foc19_w3, 
         `Takes preautions` = c_prec,
         `N (weighted sum)` = n, 
         `%` = perc) %>% 
  ungroup() %>% 
  mutate(`Takes preautions` = as_factor(`Takes preautions`)) %>% 
  ggplot(., aes(x = `Worry group`, y = `%`, group = `Takes preautions`, fill = `Takes preautions`)) + 
  geom_bar(stat = "identity", position = "stack", col = "black") + 
  scale_fill_manual(values=c("#FFFFFF", "#000000"), name = "Takes Precautions") + 
  theme_minimal()

```

Do these precautions affect QoL? Least so for the 'Coping' group (less than Unworried!) and most for those Struggling:

```{r precsqol}

data %>% 
  mutate(precqof_binary = case_when(c_precqof < 7 ~ "No reduction in quality of life", 
                                                   c_precqof > 6 ~ "Reduced quality of life")) %>%
  filter(!is.na(foc19_w3) & !is.na(precqof_binary)) %>% 
  group_by(foc19_w3, precqof_binary) %>% 
  summarise(n = round(sum(weight, na.rm = T), 0)) %>% 
  mutate(perc = round(n / sum(n)*100,0)) %>% 
  rename(`Worry group` = foc19_w3, 
         `Preautions affect QoL` = precqof_binary,
         `N (weighted sum)` = n, 
         `%` = perc) %>% 
  ungroup() %>% 
  mutate(`Preautions affect QoL` = as_factor(`Preautions affect QoL`)) %>% 
  ggplot(., aes(x = `Worry group`, y = `%`, group = `Preautions affect QoL`, fill = `Preautions affect QoL`)) + 
  geom_bar(stat = "identity", position = "stack", col = "black") + 
  scale_fill_manual(values=c("#FFFFFF", "#000000"), name = "Takes Precautions") + 
  theme_minimal()

```

What precautions do they take?

```{r whatprecs}

data %>% select(c(starts_with("c_prectyp_"), foc19_w3, weight))  %>%  mutate_at(vars(-weight),as_factor) %>% pivot_longer(-c(foc19_w3, weight), "prec") %>% filter(!is.na(value)) %>% select(-prec) %>% group_by(foc19_w3, value) %>% summarise(n = round(sum(weight, na.rm = T), 0)) %>% 
  ggplot(., aes(x = str_wrap(value, width = 40), y = n)) + 
  geom_bar(stat= "identity") + 
  facet_wrap(~foc19_w3, scales = "free", labeller = label_wrap_gen(width = 38, multi_line = TRUE)) + 
  xlab("") + 
  ylab("Number of people") + 
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

## Places of worry

```{r whereworry}

data %>% mutate(c_focloc = as_factor(c_focloc)) %>% filter(!is.na(c_focloc)) %>% group_by(c_focloc) %>% count() %>% rename(Location = c_focloc, N = n) %>% arrange(desc(N))


```


## Focloc by type of worry

Not super intersting at the moment, seems like there isn't much travel, maybe later as more people start travelling it will be better. I think the strength of this is will be looking at how it might change over time, 

```{r locbygroup}

data %>% mutate(c_focloc = as_factor(c_focloc)) %>% filter(!is.na(c_focloc)) %>% group_by(c_focloc, foc19_w3) %>% count() %>% rename(Location = c_focloc, N = n) %>% arrange(desc(N)) %>% 
ggplot(. ,aes (x = Location, y = N, group = foc19_w3, fill = foc19_w3)) + 
  geom_bar(stat = "identity", position = "stack") + 
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```




# Demographic variation in worry about covid19


## Race/gender

```{r}

multi1_df <- data %>% select(foc19_w3, age, gender, race, weight) %>% 
  mutate(race = as_factor(race), 
         race = case_when(
    grepl("Asian or Asian British", race) |
    grepl("Black or Black British", race) |
    grepl("Mixed", race) ~ "BAME",
    grepl("White", race) ~ "White", 
    TRUE ~ "Other or did not say"
          )
  ) %>% 
  mutate_at(vars(-weight), as_factor) %>% filter(gender != "Non-binary", race != "Other or did not say") %>%
  droplevels

multi1_df %>% 
  group_by(foc19_w3, race) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% #sum weight 
  mutate(percent = n / sum(n)) %>% 
  ggplot(., aes(x = foc19_w3, y = percent, fill = race)) + 
  geom_bar(stat = "identity", position = "stack", col = "black") + 
  theme_minimal() + 
  scale_fill_manual(values=c("#FFFFFF", "#000000"), name = "Ethnicity") + 
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    xlab("") + 
    ylab("Percent") + 
  labs(title = "Difference in ethnicity between worry groups") 


```

```{r gender}
multi1_df %>% 
  group_by(foc19_w3, gender) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% #sum weight 
  mutate(percent = n / sum(n)) %>% 
  ggplot(., aes(x = foc19_w3, y = percent, fill = gender)) + 
  geom_bar(stat = "identity", position = "stack", col = "black") + 
  theme_minimal() + 
  scale_fill_manual(values=c("#FFFFFF", "#000000"), name = "Gender") + 
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    xlab("") + 
    ylab("Percent") + 
  labs(title = "Difference in gender between worry groups") 


```


## Key workers

```{r}

data %>% mutate(a_covidjob = as_factor(a_covidjob)) %>% 
  filter(!is.na(a_covidjob)) %>% 
  mutate(covjob = ifelse(a_covidjob == "None of these", "Not key worker", "Key worker" )) %>% 
  group_by(foc19_w3, covjob) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% #sum weight 
  mutate(percent = n / sum(n), 
         w_covidjob = str_wrap(covjob, 25)) %>% 
  ggplot(., aes(x = foc19_w3, y = percent, fill = w_covidjob)) + 
  geom_bar(stat = "identity", position = "stack", col = "black") + 
  theme_minimal() + 
  scale_fill_manual(values=c("#FFFFFF", "#000000"), name = "Key worker") + 
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    xlab("") + 
    ylab("Percent") + 
  labs(title = "Are keyworkers in different worry groups?")


```


# Mental health outcomes between worry groups

## Thinking about how you felt yesterday, overall, how strongly did you feel the following emotions?

```{r covidemotions}

myColors <- brewer.pal(4,"BuGn")
names(myColors) <- levels(data$b_covidemotion_1)

data %>% 
  select(starts_with("b_covidemotion"), foc19_w3, weight) %>% 
  pivot_longer(-c(foc19_w3, weight),"emo") %>% 
  mutate(value = as_factor(value), 
         emo = case_when(emo == "b_covidemotion_1" ~ "Anxiety", 
                         emo == "b_covidemotion_2" ~ "Anger", 
                         emo == "b_covidemotion_3" ~ "Loneliness",
                         emo == "b_covidemotion_4" ~ "Happiness")) %>% 
  group_by(foc19_w3, emo, value) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% #sum weight 
  mutate(percent = n / sum(n)) %>% 
  ggplot(., aes(x = foc19_w3, y = percent, fill = value)) + 
  geom_bar(stat = "identity", position = "stack", col = "black") + 
  theme_minimal() + 
  scale_fill_manual(name = "",values = myColors) + 
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    xlab("") + 
    ylab("Percent") + 
  labs(title = "") + 
  facet_wrap(~emo)
  
```

## Overall, how satisfied are you with your life nowadays?

```{r covidsatisf}

myColors <- rev(brewer.pal(5,"BuGn"))
names(myColors) <- levels(data$b_covidsatisf)

data %>% 
  mutate(b_covidsatisf = as_factor(b_covidsatisf)) %>% 
  group_by(foc19_w3, b_covidsatisf) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% #sum weight 
  mutate(percent = n / sum(n)) %>% 
  ggplot(., aes(x = foc19_w3, y = percent, fill = b_covidsatisf)) + 
  geom_bar(stat = "identity", position = "stack", col = "black") + 
  theme_minimal() + 
  scale_fill_manual(name = "",values = myColors) + 
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    xlab("") + 
    ylab("Percent") + 
  labs(title = "") 
  
  

```

## Overall, to what extent do you feel that the things you do in your life are worthwhile?

```{r covidworth}

names(myColors) <- levels(data$b_covidworth)

data %>% 
  mutate(b_covidworth = as_factor(b_covidworth)) %>% 
  group_by(foc19_w3, b_covidworth) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% #sum weight 
  mutate(percent = n / sum(n)) %>% 
  ggplot(., aes(x = foc19_w3, y = percent, fill = b_covidworth)) + 
  geom_bar(stat = "identity", position = "stack", col = "black") + 
  theme_minimal() + 
  scale_fill_manual(name = "",values = myColors) + 
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    xlab("") + 
    ylab("Percent") + 
  labs(title = "") 
  
  

```





