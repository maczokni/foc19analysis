---
title: "Crime Science Paper"
author: "Reka Solymosi"
date: "16/06/2020"
output: word_document
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(haven)
library(ggplot2)
library(tidyr)
library(stringr)
library(forcats)
library(nnet)
library(stargazer)
library(broom)
library(MASS)
library(dplyr)
library(networkD3)
library(RColorBrewer)
library(janitor)
library(gridExtra)
library(Hmisc)

# read in data
data <- read_dta("https://www.dropbox.com/s/l0k2if9axtpu8mu/Covid-19_Police_Study_Longitudinal_W1-W3.dta?dl=1")
#filter out people who didn't answer foc-19 Q and choose weight to use throughout
data <- data %>% mutate(weight = ifelse(is.na(w1w2weight), 1, w1w2weight))


data <- data %>% 
  mutate(foc19_s_w3 = case_when(
          # Unworried
          c_foc==2 ~ "Unworried", # not worried
          # Functional
          c_foc==1 & # worried about catching covid in past 3 weeks
          c_focqol < 7   ~ "Functional Worry",  #  quality of life is not reduced by worry
         #Dysfunctional
          c_foc== 1 & # worried about covid
            c_focqol > 6  ~ "Dysfunctional Worry", #quality of life affected by worry
          TRUE ~ NA_character_),    #everyone else 
    foc19_s_w2 = case_when(
          # Unworried
          b_foc==2 ~ "Unworried", # not worried
          # Functional
          b_foc==1 & # worried about catching covid in past 3 weeks
          b_focqol < 7   ~ "Functional Worry",  #  quality of life is not reduced by worry
         #Dysfunctional
          b_foc== 1 & # worried about covid
            b_focqol > 6  ~ "Dysfunctional Worry", #quality of life affected by worry
          TRUE ~ NA_character_),    #everyone else 
         #wave3
         foc19_c_w3 = case_when(
          # Unworried
          c_foc==2 ~ "Unworried", # not worried
          # Functional
          c_foc==1 & # worried about catching covid in past 3 weeks
            c_prec == 1 & # takes precautions
            c_precs > 6 & # feels safer from precs
            c_precqof < 7 & # quality of life is not reduced by precautions
          c_focqol < 7   ~ "Functional Worry",  #  quality of life is not reduced by worry
         #Dysfunctional
          c_foc== 1 & # worried about covid
            b_focqol > 6  ~ "Dysfunctional Worry", #quality of life affected by worry
         # or 
          c_foc == 1 &  # worried about covid
           c_prec == 2  ~ "Dysfunctional Worry", # and doesn't take precautions
             # or  
           c_foc== 1 &  # worried about covid
             c_prec == 1 & # takes precautions
             c_precqof > 6  ~ "Dysfunctional Worry", # and quality of life affected by precautions
         # or  
           c_foc== 1 &  # worried about covid
             c_prec == 1 & # takes precautions
             c_precs < 7  ~ "Dysfunctional Worry", #doesnt feel safer from precs
            TRUE ~ NA_character_),
         foc19_c_w2 = case_when(
            # Unworried
            b_foc==2 ~ "Unworried", # not worried
            # Functional
            b_foc==1 & # worried about catching covid in past 3 weeks
            b_focqol < 7  & # quality of life not reduced by worry 
              b_prec == 1 & # takes precautions
              b_precs >= 6 & # feels safer from precs
              b_precqof < 7 ~ "Functional Worry",  #  quality of life is not reduced by precautions
           #Dysfunctional
            b_foc== 1 & # worried about covid
              b_focqol > 6  ~ "Dysfunctional Worry", # and quality of life affected by worry
           # or 
            b_foc== 1 &  # worried about covid
             b_prec == 2  ~ "Dysfunctional Worry", # and doesn't take precautions
             # or  
           b_foc== 1 &  # worried about covid
             b_prec == 1 & # takes precautions
             b_precqof > 6  ~ "Dysfunctional Worry", # and quality of life affected by precautions
           # or  
           b_foc== 1 &  # worried about covid
             b_prec == 1 & # takes precautions
             b_precs <= 6  ~ "Dysfunctional Worry", #doesnt feel safer from precs
            TRUE ~ NA_character_)    #everyone else 
          ) 

data$foc19_c_w2 <- factor(data$foc19_c_w2, levels = c("Unworried", "Functional Worry","Dysfunctional Worry" ))
data$foc19_c_w3 <- factor(data$foc19_c_w3, levels = c("Unworried", "Functional Worry","Dysfunctional Worry" ))
data$foc19_s_w2 <- factor(data$foc19_s_w2, levels = c("Unworried", "Functional Worry","Dysfunctional Worry" ))
data$foc19_s_w3 <- factor(data$foc19_s_w3, levels = c("Unworried", "Functional Worry","Dysfunctional Worry" ))

data$foc19_w2 <- data$foc19_c_w2
data$foc19_w3 <- data$foc19_c_w3

data$foc19_w2 <- factor(data$foc19_w2, levels = c("Unworried", "Functional Worry","Dysfunctional Worry" ))
data$foc19_w3 <- factor(data$foc19_w3, levels = c("Unworried", "Functional Worry","Dysfunctional Worry" ))

data <- data %>% 
  mutate(race_coded = as_factor(race), 
         race_coded = case_when(
    grepl("Asian or Asian British", race_coded) |
    grepl("Black or Black British", race_coded) |
    grepl("Mixed", race_coded) ~ "BAME",
    grepl("White", race_coded) ~ "White", 
    TRUE ~ "Other or did not say"), 
    gender = as_factor(gender)) 


```




# Frame

- Worry about COVID-19 has been discussed in media + research as something which affects people's emotional wellbeing and their behaviours. 

- Drawing on research on worry about crime, we hypothesise that worry can have a range of effects, depending on how it is experienced. 

- Specifically, building on classifying people as functionally/dysfunctionally worried, we categories people into three groups: Unworried, Coping, Struggling. 


- Results indicate that some worry is actually good; those who are 'Coping' take precautions which don't affect QoL, they have fewer negative outcomes and get back to socialising more so than either those 'Unworried' or those 'Struggling'. 'Struggling' experience most negative outcomes, so these are people who should be identified for targeted interventions to help people deal with worry about COVID19. However, asking simply whether people are worried or not does not tap into this groups. 


 - Membership in groups associated with perceived risk (likelihood/ severity/ control) is better. One approach to reduce dysfunctional worry could be to try to inform people/create comms that address these factors?
 
 - comms messaging like the above can help people move from dysfunctional to functional, we know people *can* move between groups because they moved between w2 and w3

# Results - descriptives

```{r focdesc}

foc_tab <- data %>% 
  filter(!is.na(b_foc)) %>% 
  group_by(b_foc) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% 
  mutate(perc = round(n / sum(.$n)*100,0))

freq_tab <- data %>% 
  filter(!is.na(b_focfr)) %>% 
  group_by(b_focfr) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% 
  mutate(perc = round(n / sum(.$n)*100,0)) 

intens_tab <- data %>% 
  filter(!is.na(b_focwo)) %>% 
  group_by(b_focwo) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% 
  mutate(perc = round(n / sum(.$n)*100,0)) 

data$b_foc_f <- as_factor(data$b_foc)
data$b_prec_f <- as_factor(data$b_prec)

```

It seems that people do experience worry about COVID-19. When asked the question “In the past 3 weeks, have you ever felt worried about getting COVID-19?” in wave 2, `r foc_tab %>% filter(b_foc == 2) %>% pull(perc)`% of people said that “No”, they had not felt worried about getting COVID-19 in the past 3 weeks. From those who said “Yes”, the specific instance of worry varied in frequency and intensity.  `r freq_tab %>% filter(b_focfr == 1) %>%  pull(perc)`% of people who were worried only experienced this “Once or twice” in the last 3 weeks, while `r freq_tab %>% filter(b_focfr == 8) %>%  pull(perc)`% worried more than 10 times in this timeframe. 


Criminological work has found that, while some instances of worry can be destructive and paralysing, people and communities have the potential to convert worry about crime into constructive action [@jackson2010functional; @jackson2009untangling]. In our study, the majority of people said ‘yes’ (`r data %>% group_by(b_prec_f) %>% summarise(n = sum(weight, na.rm = T)) %>% mutate(perc = round(n / sum(.$n)*100,0)) %>% filter(b_prec_f == "Yes") %>% pull(perc)`%) when we asked ‘do you take any precautions against getting Covid-19?’. This implies that this fear can be considered functional, as it conceivably triggered self-protective behaviours against the virus.


Based on their worries about catching the virus, as well as the self-reported effect of their worries, we can divide research participants into one of three groups:

- The ‘unworried’ group (`r data %>% group_by(foc19_w2) %>% summarise(n = sum(weight, na.rm = T)) %>% mutate(perc = round(n / sum(.$n)*100,0)) %>% filter(foc19_w2 == "Unworried") %>% pull(perc)`%): those who had not worried once about catching Covid-19 over the previous three weeks; 
- The ‘coping’ group (`r data %>% group_by(foc19_w2) %>% summarise(n = sum(weight, na.rm = T)) %>% mutate(perc = round(n / sum(.$n)*100,0)) %>% filter(foc19_w2 == "Coping") %>% pull(perc)`%): those who had worried, but report that their quality of life was not affected by this worry; and,
- The ‘struggling’ group (`r data %>% group_by(foc19_w2) %>% summarise(n = sum(weight, na.rm = T)) %>% mutate(perc = round(n / sum(.$n)*100,0)) %>% filter(foc19_w2 == "Struggling") %>% pull(perc)`%): those who had worried, and reported that their quality of life was affected by this worry.

Table x shows some descriptive statistics of these groups across demographic measures (gender, age, ethnicity), measures related to covid19 (key worker, affected by covid, had covid), mental health/emotions outcome measurses, and behavioural outcomes (takes precautions, and whether those precautions affect quality of life). 




```{r desctable2}

data <- data %>% 
  mutate(race_coded = as_factor(race), 
         race_coded = case_when(
    grepl("Asian or Asian British", race_coded) |
    grepl("Black or Black British", race_coded) |
    grepl("Mixed", race_coded) ~ "BAME",
    grepl("White", race_coded) ~ "White", 
    TRUE ~ "Other or did not say"
          )) %>% 
  rowwise() %>% 
  mutate(covaff_w2 = sum(b_covidaffect_1, b_covidaffect_2 , b_covidaffect_3,
                         b_covidaffect_4, b_covidaffect_5 , b_covidaffect_6,
                         b_covidaffect_7, b_covidaffect_8 , na.rm = T)) %>% 
  filter(gender != "Non-binary", race_coded != "Other or did not say") %>%
  droplevels 
    


data %>% 
  mutate(precqof_binary = case_when(b_precqof < 7 ~ "No reduction in quality of life", 
                                                   b_precqof > 6 ~ "Reduced quality of life")) %>% 
  filter(!is.na(foc19_w2)) %>% 
  group_by(foc19_w2) %>% 
  summarise(
   perc_age_16_24 = round(sum(weight[age ==1], na.rm = T)/sum(weight, na.rm = T)*100,0), 
    perc_age_25_44 = round(sum(weight[age ==2], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_age_45_64 = round(sum(weight[age ==3], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_age_65_over = round(sum(weight[age ==4], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_female = round(sum(weight[gender == "Female"], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_BAME = round(sum(weight[race_coded == "BAME"], na.rm = T)/sum(weight, na.rm = T)*100,0), 
    perc_keyworker = round(sum(weight[a_covidjob != 10 & !is.na(a_covidjob)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_had_covid = round(sum(weight[b_cov != 4 & b_cov != 5 & !is.na(b_cov)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_lost_job = round(sum(weight[b_covidaffect_1 ==1 & !is.na(b_cov)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_hhold_lost_job = round(sum(weight[b_covidaffect_2 ==1 & !is.na(b_cov)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_cant_pay_bills = round(sum(weight[b_covidaffect_3 ==1 & !is.na(b_cov)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_evicted = round(sum(weight[b_covidaffect_4 ==1 & !is.na(b_cov)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_no_food = round(sum(weight[b_covidaffect_5 ==1 & !is.na(b_cov)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_no_meds = round(sum(weight[b_covidaffect_6 ==1 & !is.na(b_cov)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_lovedone_hosp = round(sum(weight[b_covidaffect_7 ==1 & !is.na(b_cov)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_lost_lovedone = round(sum(weight[b_covidaffect_8 ==1 & !is.na(b_cov)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    # w_mean_score_affected_by_covid = round(sum(covaff_w2*weight, na.rm = T)/sum(.$weight,na.rm = T),3), 
    perc_worried = round(sum(weight[b_covconc > 3 & !is.na(b_covconc)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_takes_prec = round(sum(weight[b_prec == 1], na.rm = T)/sum(weight, na.rm = T)*100,0),
    precs_reduce_qol = round(sum(weight[precqof_binary == "Reduced quality of life"], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_felt_anxiety = round(sum(weight[b_covidemotion_1 != 11 & !is.na(b_covidemotion_1)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_felt_anger = round(sum(weight[b_covidemotion_2 != 11 & !is.na(b_covidemotion_2)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_felt_loneliness = round(sum(weight[b_covidemotion_3 != 11 & !is.na(b_covidemotion_3)], na.rm = T)/sum(weight, na.rm = T)*100,0),
    perc_not_at_all_felt_happiness = round(sum(weight[b_covidemotion_4 == 11 & !is.na(b_covidemotion_4)], na.rm = T)/sum(weight, na.rm = T)*100,0), 
    perc_not_at_all_satisfied_w_life = round(sum(weight[b_covidsatisf == 1 & !is.na(b_covidsatisf)], na.rm = T)/sum(weight, na.rm = T)*100,0), 
    perc_not_at_all_worthwhile = round(sum(weight[b_covidworth == 1 & !is.na(b_covidworth)], na.rm = T)/sum(weight, na.rm = T)*100,0), 
    
    

    
    
    
  ) %>% 
  t %>% 
  as.data.frame %>%
  row_to_names(row_number = 1) 



```

```{r modelgroups}

data$foc19_w2 <- relevel(data$foc19_w2, ref = "Unworried")
data$had_covid <- ifelse(data$b_cov != 4 & data$b_cov != 5 & !is.na(data$b_cov), 1, 0)

multi1 <- multinom(foc19_w2~as_factor(age)+gender+race_coded+a_covidjob+had_covid+covaff_w2+b_covconc, data = data, weights = weight)
stargazer(multi1, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)


```


# Results - for arguments


## Everyone takes precautions, but coping are less likely to report the precautions affecting their quality of life (vs unworried)

```{r precs1}

data <- data %>% 
  mutate(precqof_binary = case_when(b_precqof < 7 ~ "No reduction in quality of life", 
                                                   b_precqof > 6 ~ "Reduced quality of life")) 
data %>% 
  group_by(foc19_w2, precqof_binary) %>% 
  filter(!is.na(precqof_binary)) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% #sum weight 
  mutate(percent = n / sum(n)) %>% 
  ggplot(., aes(x = foc19_w2, y = percent, fill = precqof_binary)) + 
  geom_bar(stat = "identity", position = "stack", col = "black") + 
  theme_minimal() + 
  scale_fill_manual(values=c("#FFFFFF", "#000000"), name = "Effect of precautions \non quality of life") + 
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    xlab("") + 
    ylab("Percent") + 
  labs(title = "Extent to which precautions taken by \ndifferent worry groups affect their \nquality of life")


```

```{r precs2}


data$precqof_binary <- factor(data$precqof_binary, levels = c("No reduction in quality of life","Reduced quality of life" ))
fit <- glm(precqof_binary~foc19_w2, data=data ,family=binomial(), weights = weight)
fit2 <- glm(precqof_binary~foc19_w2 + a_covidjob + b_cov + covaff_w2 + age + gender + race_coded, data=data %>% filter(gender != "Non-binary", race_coded != "Other or did not say") %>% droplevels ,family=binomial(), weights = weight)
 

stargazer(fit, fit2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)


```

```{r precsafer}


data <- data %>% 
  mutate(precs_binary = case_when(b_precs < 7 ~ "Not much safer", 
                                                   b_precqof > 6 ~ "Safer")) 

data %>% filter(!is.na(precs_binary)) %>% group_by(foc19_w2, precs_binary) %>% summarise(n = sum(weight, na.rm = T)) %>% mutate(perc = n/sum(n)*100)



data %>% 
  group_by(foc19_w2, precs_binary) %>% 
  filter(!is.na(precs_binary)) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% #sum weight 
  mutate(percent = n / sum(n)) %>% 
  ggplot(., aes(x = foc19_w2, y = percent, fill = precs_binary)) + 
  geom_bar(stat = "identity", position = "stack", col = "black") + 
  theme_minimal() + 
  scale_fill_manual(values=c("#FFFFFF", "#000000"), name = "Do precautions make feel safer?") + 
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    xlab("") + 
    ylab("Percent") + 
  labs(title = "Extent to which precautions taken by \ndifferent worry groups make them \nfeel safer")

```

```{r precsafermods}


data$precs_binary <- factor(data$precs_binary, levels = c("Not much safer","Safer" ))

fit <- glm(precs_binary~foc19_w2, data=data ,family=binomial(), weights = weight)
fit2 <- glm(precs_binary~foc19_w2 + a_covidjob + b_cov + covaff_w2 + age + gender + race_coded, data=data %>% filter(gender != "Non-binary", race_coded != "Other or did not say") %>% droplevels ,family=binomial(), weights = weight)
 

stargazer(fit, fit2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)


```



```{r prectypediff}

data %>% group_by(foc19_w2) %>% 
  summarise(soc_dist = round(sum(weight[b_prectyp_1 == 1 & !is.na(b_prectyp_1)], na.rm = T)/sum(weight, na.rm = T)*100,0), 
            ppe = round(sum(weight[b_prectyp_6 == 1 & !is.na(b_prectyp_6)], na.rm = T)/sum(weight, na.rm = T)*100,0),
            no_transit = round(sum(weight[b_prectyp_7 == 1 & !is.na(b_prectyp_7)], na.rm = T)/sum(weight, na.rm = T)*100,0),
            diff_rout_or_time = round(sum(weight[b_prectyp_8 == 1 & !is.na(b_prectyp_8)], na.rm = T)/sum(weight, na.rm = T)*100,0),
            avoid_go_out = round(sum(weight[b_prectyp_10 == 1 & !is.na(b_prectyp_10)], na.rm = T)/sum(weight, na.rm = T)*100,0),
            other = round(sum(weight[b_prectyp_11 == 1 & !is.na(b_prectyp_11)], na.rm = T)/sum(weight, na.rm = T)*100,0))


```




```{r}



# Run the model
model1 <- multinom(foc19_w2 ~ a_cov + covaff_w2, data=data)
model2 <- multinom(foc19_w2 ~ a_cov + covaff_w2 + as_factor(age)+gender+race_coded+a_covidjob, data=data)

stargazer(model1, model2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)

```



## Negative outcomes on emotional wellbeing


We compare the difference between groups and asking people a generic question "". 

Evidently, measuring a generic "are you worried" is not that great because it groups together the functionally/dysfunctionally worried, instead looking at the groups shows that it's those who are struggling that have these negative emotional wellbeing outcomes:

```{r emots}

data <- data %>% 
  mutate(felt_worried = case_when(b_covidemotion_1 != 11 & !is.na(b_covidemotion_1) ~ "Yes", 
                                  b_covidemotion_1 == 11 ~ "No", 
                                  is.na(b_covidemotion_1) ~ NA_character_), 
         felt_anger = case_when(b_covidemotion_2 != 11 & !is.na(b_covidemotion_2) ~ "Yes", 
                                  b_covidemotion_2 == 11 ~ "No", 
                                  is.na(b_covidemotion_2) ~ NA_character_), 
         felt_loneliness = case_when(b_covidemotion_3 != 11 & !is.na(b_covidemotion_3) ~ "Yes", 
                                  b_covidemotion_3 == 11 ~ "No", 
                                  is.na(b_covidemotion_3) ~ NA_character_), 
         not_felt_happiness = case_when(b_covidemotion_4 == 11  ~ "Yes", 
                                  b_covidemotion_4 != 11 & !is.na(b_covidemotion_4) ~ "No", 
                                  is.na(b_covidemotion_3) ~ NA_character_), 
         not_at_all_satisfied_w_life = case_when(b_covidsatisf == 1   ~ "Yes", 
                                  b_covidsatisf != 1 & !is.na(b_covidsatisf) ~ "No", 
                                  is.na(b_covidsatisf) ~ NA_character_), 
          not_at_all_worthwhile = case_when(b_covidworth == 1   ~ "Yes", 
                                  b_covidworth != 1 & !is.na(b_covidworth) ~ "No", 
                                  is.na(b_covidworth) ~ NA_character_)
         )

```

Felt worried: 

```{r worriedmod}

data$felt_worried <- factor(data$felt_worried, levels = c("No","Yes" ))

m1 <- glm(felt_worried ~ b_covconc , data=data ,family=binomial(), weights = weight)
m2 <- glm(felt_worried ~ b_covconc + foc19_w2 , data=data ,family=binomial(), weights = weight)

stargazer(m1, m2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)

```

Felt angry: 

```{r angrymod}

data$felt_anger <- factor(data$felt_anger, levels = c("No","Yes" ))

m1 <- glm(felt_anger ~ b_covconc , data=data ,family=binomial(), weights = weight)
m2 <- glm(felt_anger ~ b_covconc + foc19_w2 , data=data ,family=binomial(), weights = weight)

stargazer(m1, m2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)

```

Felt lonely: 

```{r lonelymod}

data$felt_loneliness <- factor(data$felt_loneliness, levels = c("No","Yes" ))

m1 <- glm(felt_loneliness ~ b_covconc , data=data ,family=binomial(), weights = weight)
m2 <- glm(felt_loneliness ~ b_covconc + foc19_w2 , data=data ,family=binomial(), weights = weight)

stargazer(m1, m2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)

```


Not at all felt happy: 

```{r heppymod}

data$not_felt_happiness <- factor(data$not_felt_happiness, levels = c("No","Yes" ))

m1 <- glm(not_felt_happiness ~ b_covconc , data=data ,family=binomial(), weights = weight)
m2 <- glm(not_felt_happiness ~ b_covconc + foc19_w2 , data=data ,family=binomial(), weights = weight)

stargazer(m1, m2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)

```



Not at all satisfied with life: 

```{r satisfmod}

data$not_at_all_satisfied_w_life <- factor(data$not_at_all_satisfied_w_life, levels = c("No","Yes" ))

m1 <- glm(not_at_all_satisfied_w_life ~ b_covconc , data=data ,family=binomial(), weights = weight)
m2 <- glm(not_at_all_satisfied_w_life ~ b_covconc + foc19_w2 , data=data ,family=binomial(), weights = weight)

stargazer(m1, m2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)

```


Does not feel worthwhile: 

```{r worthmod}

data$not_at_all_worthwhile <- factor(data$not_at_all_worthwhile, levels = c("No","Yes" ))

m1 <- glm(not_at_all_worthwhile ~ b_covconc , data=data ,family=binomial(), weights = weight)
m2 <- glm(not_at_all_worthwhile ~ b_covconc + foc19_w2 , data=data ,family=binomial(), weights = weight)

stargazer(m1, m2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)

```




```{r allemotsmods}

m1 <- glm(felt_worried ~ foc19_w2 +  a_covidjob + b_cov + covaff_w2 + age + gender + race_coded, data=data ,family=binomial(), weights = weight)
m2 <- glm(felt_anger ~ foc19_w2 +  a_covidjob + b_cov + covaff_w2 + age + gender + race_coded, data=data ,family=binomial(), weights = weight)
m3 <- glm(felt_loneliness ~ foc19_w2 +  a_covidjob + b_cov + covaff_w2 + age + gender + race_coded, data=data ,family=binomial(), weights = weight)
m4 <- glm(not_felt_happiness ~ foc19_w2 +  a_covidjob + b_cov + covaff_w2 + age + gender + race_coded, data=data ,family=binomial(), weights = weight)
m5 <- glm(not_at_all_satisfied_w_life ~ foc19_w2 +  a_covidjob + b_cov + covaff_w2 + age + gender + race_coded, data=data ,family=binomial(), weights = weight)
m6 <- glm(not_at_all_worthwhile ~ foc19_w2 +  a_covidjob + b_cov + covaff_w2 + age + gender + race_coded, data=data ,family=binomial(), weights = weight)


stargazer(m1, m2, m3, m4, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)



```
nyenye

```{r emotmodsr2}

stargazer(m5, m6, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)
```



Emotion score: 

(Note recoded, for b_covidemotion_1 through _3 11 as 1, 12 as 2, 13 as 3, 14 as 4, and 15 as 5, 
and for b_covidemotion_4 the reverse (11 as 5, 12 as 4, 13 as 3, 14 as 2, 15 as 1), so higher score = worse emotions outcome)


```{r emotionscore}

data <- data %>%  
  mutate(worry_n = case_when(b_covidemotion_1 == 11 ~ 1,
                             b_covidemotion_1 == 12 ~ 2,
                             b_covidemotion_1 == 13 ~ 3,
                             b_covidemotion_1 == 14 ~ 4,
                             b_covidemotion_1 == 15 ~ 5,
                             TRUE ~ NA_real_), 
         anger_n = case_when(b_covidemotion_2 == 11 ~ 1,
                             b_covidemotion_2 == 12 ~ 2,
                             b_covidemotion_2 == 13 ~ 3,
                             b_covidemotion_2 == 14 ~ 4,
                             b_covidemotion_2 == 15 ~ 5,
                             TRUE ~ NA_real_), 
         lonely_n = case_when(b_covidemotion_3 == 11 ~ 1,
                             b_covidemotion_3 == 12 ~ 2,
                             b_covidemotion_3 == 13 ~ 3,
                             b_covidemotion_3 == 14 ~ 4,
                             b_covidemotion_3 == 15 ~ 5,
                             TRUE ~ NA_real_), 
         happy_n = case_when(b_covidemotion_4 == 11 ~ 5,
                             b_covidemotion_4 == 12 ~ 4,
                             b_covidemotion_4 == 13 ~ 3,
                             b_covidemotion_4 == 14 ~ 2,
                             b_covidemotion_4 == 15 ~ 1,
                             TRUE ~ NA_real_)) %>% 
  rowwise() %>% 
  mutate(emosum = sum(worry_n, anger_n,  lonely_n,  happy_n, na.rm = TRUE), 
         emosum = ifelse(emosum < 1, NA, emosum))


m1 <- glm.nb(emosum ~ b_covconc, data = data, weight = weight)
m2 <- glm.nb(emosum ~ b_covconc + foc19_w2, data = data, weight = weight)

         
stargazer(m1, m2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)

```


We can also add the satisfaction and worth scores to the sum, in that case I've recoded to match the aboves (ie fliped 1 through 5, so higher score is worse outcome): 


```{r emoandotherscore}


data <- data %>% mutate(satisf_reverse = case_when(b_covidsatisf == 1 ~ 5,
                                                   b_covidsatisf == 2 ~ 4,
                                                   b_covidsatisf == 3 ~ 3,
                                                   b_covidsatisf == 4 ~ 2,
                                                   b_covidsatisf == 5 ~ 1,
                                                   TRUE ~ NA_real_), 
                        worth_reverse = case_when(b_covidworth == 1 ~ 5,
                                                   b_covidworth == 2 ~ 4,
                                                   b_covidworth == 3 ~ 3,
                                                   b_covidworth == 4 ~ 2,
                                                   b_covidworth == 5 ~ 1,
                                                   TRUE ~ NA_real_) ) %>% 
  rowwise() %>% 
  mutate(allemosum = sum(worry_n, anger_n,  lonely_n,  happy_n, satisf_reverse, worth_reverse, na.rm = TRUE), 
         allemosum = ifelse(allemosum < 1, NA, allemosum))

m1 <- glm.nb(allemosum ~ b_covconc, data = data, weight = weight)
m2 <- glm.nb(allemosum ~ b_covconc + foc19_w2, data = data, weight = weight)

         
stargazer(m1, m2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)

```


## Re-engaging


Group people into whether the government is easing lockdown at the right speed, too slowly, or too quickly (c_lockease and c_locksp). 

```{r easinggroup}

data <- data %>% 
  mutate(easing = case_when(c_lockeas == 1 ~ "Right speed", 
                            c_lockeas == 2 & c_locksp < 3 ~ "Too quickly", 
                            c_lockeas == 2 & c_locksp > 2 ~ "Too slowly",
                            TRUE ~ NA_character_))

```


```{r easingchart}

data %>% group_by(foc19_w3, easing) %>% 
  filter(!is.na(easing) & !is.na(foc19_w3)) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% #sum weight 
  mutate(percent = n / sum(n)) %>% 
  ggplot(., aes(x = foc19_w3, y = percent, fill = as_factor(easing))) + 
  geom_bar(stat = "identity", position = "stack", col = "black") + 
  theme_minimal() + 
  scale_fill_manual(values=c("#FFFFFF", "#808080", "#000000"), name = "Is lockdown eased at right speed?") + 
  scale_y_continuous(labels = scales::percent) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    xlab("") + 
    ylab("Percent") + 
  labs(title = "")


```

Group together "right speed" and "too slow" to have outcome be whether they perceive lockdown being eased too quickly or no. All worry groups more likely to say too quickly compared with unworried. General concern also significant:


```{r quickease}

data <- data %>% 
  mutate(quickease = case_when(easing == "Too quickly" ~ "Yes", 
                               easing == "Too slowly" | easing == "Right speed" ~ "No",
                               TRUE ~ NA_character_))

mod_df <- data %>% 
  filter(!is.na(quickease)) %>%
  filter(gender != "Non-binary", race_coded != "Other or did not say") %>%
  droplevels 

mod_df$race_coded <- relevel(as_factor(mod_df$race_coded), ref = "White")
mod_df$quickease <- relevel(as_factor(mod_df$quickease), ref = "No")

lock_mod_1 <- glm(quickease ~foc19_w3, data= mod_df,family=binomial(), weights = weight)
lock_mod_2 <- glm(quickease ~foc19_w3 + c_covconc, data= mod_df,family=binomial(), weights = weight)
lock_mod_3 <- glm(quickease ~foc19_w3 + c_covconc+ c_covknow, data=mod_df ,family=binomial(), weights = weight)
lock_mod_4 <- glm(quickease ~foc19_w3 + c_covconc+ c_covknow + age + gender + race_coded , data= mod_df,family=binomial(), weights = weight)

stargazer(lock_mod_1, lock_mod_2,lock_mod_3,lock_mod_4, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE, omit.stat = "theta")


```


Are they reengaging more? We asked whether or not people engaged in the following behaviours in wave 2 and wave 3: 

- Socialised in person with friends or relatives whom you don't live with 
- Went out for a walk, run, or cycle and spent more than a few minutes sitting somewhere to relax 
- Travelled for leisure (e.g. driven somewhere to go for a walk) 

In wave 2 these were breaking the regulations, but in wave 3 they were allowed to do these. So we can say if the score goes up, they re-engaged, whereas if it stays the same or goes down (weird) then they are not re-engaging. 

Coded as: calculated a re-engagement score, which is the score for the compliance item in wave 2 subtracted from the sum of the compliance items in wave 3. This means higher score means more re-engagement (0 is same engagement, negative is more engagement in wave 2 than wave 3 (shouldnt be a lot of this in theory??) and positive is more participation in the activity in wave 3 than wave 2). 


Coping people engage in more socialising: 

```{r socialisingmod}

data <- data %>% 
  mutate(more_socialising = ifelse((c_covidcompliance_1 - b_covidcompliance_1) > 0, "Yes", "No"),
         more_relaxing_out = ifelse((c_covidcompliance_2 - b_covidcompliance_2) > 0, "Yes", "No"),
         more_leisure_travel = ifelse((c_covidcompliance_3 - b_covidcompliance_3) > 0, "Yes", "No")
         )

data$more_socialising <- factor(data$more_socialising, levels = c("No","Yes" ))

m1 <- glm(more_socialising ~ c_covconc , data=data ,family=binomial(), weights = weight)
m2 <- glm(more_socialising ~ c_covconc + foc19_w3 , data=data ,family=binomial(), weights = weight)

stargazer(m1, m2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)


```


## Risk perception 

What makes someone coping/struggling/unworried? One thing that has shown to have effect on fear of crime is risk perception (perceived likelihood/control/consequence). 

- Perceived Likelihood: "How likely do you think it is that, in the next 3 weeks, you will catch COVID-19?"
- Perceived Severity of Consequences: "If you contracted COVID-19, how severe do you expect its consequences to be on your health?"
- Perceived Control: "To what extent do you feel able to control whether or not, in the next 3 weeks, you will catch COVID-19?"


```{r riskresultsfig2}

data <- data %>% mutate(c_riskcn = case_when(c_riskc == 6 ~ 3,
                                             c_riskc == 7 ~ 4,
                                             c_riskc == 8 ~ 5, 
                                             TRUE ~ as.numeric(c_riskc)),
                        c_riskln = case_when(c_riskl == 6 ~ 3,
                                             c_riskl == 7 ~ 4,
                                             c_riskl == 8 ~ 5, 
                                             TRUE ~ as.numeric(c_riskl)), 
                        c_risksn = case_when(c_risks == 6 ~ 3,
                                             c_risks == 7 ~ 4,
                                             c_risks == 8 ~ 5, 
                                             TRUE ~ as.numeric(c_risks)))

lhood <- ggplot(data %>% filter(!is.na(foc19_w3)), aes(x = foc19_w3, y = c_riskln, group = foc19_w3)) + 
  geom_boxplot() + 
  theme_minimal() +
  xlab("") + 
  ylab("Score (higher = more perceived likelihood)") + 
  labs(title = "Likelihood") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

severity <- ggplot(data %>% filter(!is.na(foc19_w3)), aes(x = foc19_w3, y = c_risksn, group = foc19_w3)) + 
  geom_boxplot() + 
  theme_minimal() +
  xlab("") + 
  ylab("Score (higher = more severe consequences)") + 
  labs(title = "Consequences") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

ctrl <-  ggplot(data %>% filter(!is.na(foc19_w3)), aes(x = foc19_w3, y = c_riskcn, group = foc19_w3)) + 
  geom_boxplot() + 
  theme_minimal()  +
  xlab("") + 
  ylab("Score (higher = more perceived control)") + 
  labs(title = "Control") + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

grid.arrange(lhood, severity, ctrl, nrow = 1)


```


Unworried group have lower perceived likelihood and severity of consequences and higher perceived control, the Coping group are in the middle, and the Struggling group have the highest perceived likelihood and perceive most severe consequences! 


```{r risktable3}


# 
# lik_mod <- lm(c_riskln ~ foc19_w3, data = data, weight = weight)
# ctrl_mod <- lm(c_riskcn ~ foc19_w3, data = data, weight = weight)
# sev_mod <- lm(c_risksn ~ foc19_w3, data = data, weight = weight)
# stargazer(lik_mod, ctrl_mod, sev_mod, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)
# 


# Run the model

data$foc19_w3 <- relevel(data$foc19_w3, ref = "Dysfunctional Worry")
model1 <- multinom(foc19_w3 ~ c_riskln + c_riskcn + c_risksn, data=data)
model2 <- multinom(foc19_w3 ~ c_riskln + c_riskcn + c_risksn + as_factor(age)+gender+race_coded+a_covidjob, data=data)

stargazer(model1, model2, type="text", p.auto=FALSE, apply.coef = exp, ci = FALSE)


```


So one thing could be to target these perceptions with comms etc to help people out of 'struggling' group. 


## Can people move between groups?

Yes, people move between groups! So a comms campaign like above suggested can help get people out of dysfunctional group. 


```{r funcworrychanges}

data <- data %>% mutate(
  whochangedff = case_when(foc19_w2 == "Unworried" & foc19_w3 == "Unworried" ~ "Stayed Unworried",
                           foc19_w2 == "Coping" & foc19_w3 == "Coping" ~ "Stayed Coping",
                           foc19_w2 == "Struggling" & foc19_w3 == "Struggling" ~ "Stayed Struggling",
                           foc19_w2 == "Unworried" & foc19_w3 == "Coping" ~ "Unworried to Coping",
                           foc19_w2 == "Unworried" & foc19_w3 == "Struggling" ~ "Unworried to Struggling", 
                           foc19_w2 == "Coping" & foc19_w3 == "Unworried" ~ "Coping to Unworried",
                           foc19_w2 == "Coping" & foc19_w3 == "Struggling" ~ "Coping to Struggling",
                           foc19_w2 == "Struggling" & foc19_w3 == "Unworried" ~ "Struggling to Unworried",
                           foc19_w2 == "Struggling" & foc19_w3 == "Coping" ~ "Struggling to Coping"), 
  stayedsame = case_when(
    grepl("Stayed", whochangedff) ~"stayed", 
    grepl(" to ", whochangedff)~"changed",
    TRUE ~ NA_character_))


change_tab <- data %>% 
  filter(!is.na(stayedsame)) %>% 
  group_by(stayedsame) %>% 
  summarise(n = sum(weight, na.rm = T)) %>% 
  mutate(perc = round(n/sum(n,na.rm = TRUE)*100,0)) 
```


While most people have stayed in the same group between the two waves (`r change_tab %>% filter(stayedsame == "stayed") %>% pull(perc)`%), almost a third (`r change_tab %>% filter(stayedsame == "changed") %>% pull(perc)`%) moved between categories
(Table x, Figure x). 

```{r groupchangetable}
data %>% filter(!is.na(whochangedff)) %>%  group_by(whochangedff) %>%  count()

```


Nicer visual:

```{r sankey}

sankey_df <- as.data.frame(data %>% filter(!is.na(foc19_w3) & !is.na(foc19_w2))%>% group_by(foc19_w2, foc19_w3) %>% count())
# "source" = foc19_w2, "target" = foc19_w3, "value" = n

sankey_df$foc19_w3 <- paste(sankey_df$foc19_w3, " ", sep="")

# Create nodes df
nodes <- data.frame(name=c(as.character(sankey_df$foc19_w2), as.character(sankey_df$foc19_w3)) %>% unique())

# With networkD3, connection must be provided using id, not using real name like in the links dataframe.. So we need to reformat it.
sankey_df$IDsource=match(sankey_df$foc19_w2, nodes$name)-1 
sankey_df$IDtarget=match(sankey_df$foc19_w3, nodes$name)-1


# Make the Network
sankeyNetwork(Links = sankey_df, Nodes = nodes,
              Source = "IDsource", Target = "IDtarget",
              Value = "n", NodeID = "name")

```







